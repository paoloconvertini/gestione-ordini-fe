<mat-toolbar color="primary" class="toolbar">

  <!-- LOGO/TITOLO -->
  <span class="title">Gestione Ordini</span>

  <span class="spacer"></span>

  <!-- MENU DESKTOP -->
  <div class="menu-desktop">

    <ng-container *ngFor="let item of menu">

      <!-- Se non ho permesso â†’ skip -->
      <ng-container *ngIf="hasPerm(item)">

        <!-- ðŸ”¸ Item con figli -->
        <ng-container *ngIf="item.children && hasVisibleChildren(item); else noChildren">

          <mat-menu #childMenu="matMenu">
            <ng-container *ngFor="let child of item.children">
              <button mat-menu-item *ngIf="hasPerm(child)" [routerLink]="child.route">
                {{ child.label }}
              </button>
            </ng-container>
          </mat-menu>

          <button mat-button [matMenuTriggerFor]="childMenu">
            {{ item.label }}
          </button>

        </ng-container>

        <!-- ðŸ”¸ Item senza figli -->
        <ng-template #noChildren>
          <button mat-button *ngIf="!item.children" [routerLink]="item.route">
            {{ item.label }}
          </button>
        </ng-template>

      </ng-container>

    </ng-container>

    <!-- Avatar + dropdown -->
    <button mat-icon-button [matMenuTriggerFor]="userMenu">
      <mat-icon>account_circle</mat-icon>
    </button>

    <mat-menu #userMenu="matMenu">
      <button mat-menu-item [disabled]="true">
        <mat-icon>account_circle</mat-icon>&nbsp; {{ username() }}
      </button>
      <button mat-menu-item (click)="logout()">
        <mat-icon>logout</mat-icon>
        Logout
      </button>
    </mat-menu>

  </div>

  <!-- MENU MOBILE BUTTON -->
  <button class="menu-mobile-btn" mat-icon-button (click)="toggleMobile()">
    <mat-icon>menu</mat-icon>
  </button>

</mat-toolbar>

<!-- SIDEBAR MOBILE -->
<div class="mobile-menu" *ngIf="mobileOpen">

  <ng-container *ngFor="let item of menu">

    <div *ngIf="hasPerm(item)">
      <!-- Padre -->
      <div class="mobile-menu-item" (click)="item.children ? null : toggleMobile()"
           [routerLink]="item.children ? null : item.route">
        {{ item.label }}
      </div>

      <!-- Figli -->
      <ng-container *ngFor="let child of item.children">
        <div *ngIf="hasPerm(child)"
             class="mobile-submenu-item"
             [routerLink]="child.route"
             (click)="toggleMobile()">
          {{ child.label }}
        </div>
      </ng-container>

    </div>

  </ng-container>

  <div class="mobile-divider"></div>

  <!-- Utente -->
  <div class="mobile-user">
    <div class="username">{{ username() }}</div>
    <button mat-button color="warn" (click)="logout()">Logout</button>
  </div>

</div>
